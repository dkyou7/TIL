# JWT 토큰(Token) 기반 인증

### JWT 소개 전에...

> 소개

API를 사용하는 웹서비스 개발시, 토큰을 사용하여 유저들의 인증작업을 처리하는 것은 중요하다.

> 토큰기반 인증 시스템을 사용하는 이유

**Stateful Server** : 클라이언트에게서 요청 받을 때마다, 클라이언트의 상태를 계속해서 유지하고, 이 정보를 서비스 제공에 이용한다.
ex) 세션을 유지하는 웹 서버.

**Stateless Server** : 상태를 유지하지 않는다. 상태정보를 저장하지 않으면, 서버는 클라이언트측에서 들어오는 요청으로만 작업을 처리한다. 

> 특징

1. 상태가 없다 - 클라이언트, 서버의 연결고리가 없다. - **서버의 확장성(Scalability)**이 높아진다.

2. 모바일 어플리케이션에 적합하다
3. 어플리케이션의 보안을 높일 수 있다.

> 왜 토큰을 사용하게 돼었을까?

#### 과거의 인증시스템의 작동방식

**서버 기반 인증** : 서버를 확장하기가 어렵다.

![image-20191224133557763](C:\Users\KTNET\AppData\Roaming\Typora\typora-user-images\image-20191224133557763.png)

- 유저의 수가 많으면 데이터베이스의 성능에 무리가 된다.
- 확장성 : 세션 사용시 서버를 확장하는 것이 어려워진다.
- CORS(Cross-Origin Resource Sharing) : 쿠키는 단일 도메인 및 서브 도메인에서만 작동하도록 설계되어있으므로 쿠키를 여러 도메인에서 관리하는 것이 번거롭다.

> 토큰 기반 시스템의 작동 원리

- 상태를 유지하지 않기 때문에 더이상 유저의 인증정보를 서버나 세션에 담아두지 않습니다. 

- 세션이 존재하지 않기 때문에, 유저들이 로그인 되어있는지 안되어있는지 신경쓰지 않으면서 서버를 손쉽게 확장할 수 있다.

![image-20191224134723353](C:\Users\KTNET\AppData\Roaming\Typora\typora-user-images\image-20191224134723353.png)

1. 유저가 아이디와 비밀번호로 로그인을 합니다
2. 서버측에서 해당 계정정보를 검증합니다.
3. 계정정보가 정확하다면, 서버측에서 유저에게 signed 토큰을 발급해줍니다. 여기서 signed 의 의미는 해당 토큰이 서버에서 정상적으로 발급된 토큰임을 증명하는 signature 를 지니고 있다는 것입니다
4. 클라이언트 측에서 전달받은 토큰을 저장해두고, 서버에 요청을 할 때 마다, 해당 토큰을 함께 서버에 전달합니다.(웹서버에서 토큰을 서버에 전달 할 때에는, HTTP 요청의 헤더에 토큰값을 포함시켜서 전달합니다.)
5. 서버는 토큰을 검증하고, 요청에 응답합니다.

> 토큰의 장점

1. 무상태(Stateless)
   - 토큰이 클라이언트사이드 저장되기 때문에
2. 확장성(Scalability)
   - 세션을 서버측에 저장하고 있고, 서버를 여러대를 사용하여 요청을 분산하였다면, 어떤 유저가 로그인 했을 때, 그 유저는 처음 로그인했었던 그 서버에만 요청을 보내도록 설정해야한다. 
   - 하지만 토큰을 사용한다면, 어떤 서버로 요청이 들어가던 동일한 토큰 검증과정을 거치므로 상관없다.
3. 보안성
   - 클라이언트가 서버에 요청 시, 더 이상 쿠키를 전달하지 않기 때문에 쿠키를 사용함으로 인해 발생하는 취약점이 사라진다. 
4. 확장성(Extensibility)
   - 

